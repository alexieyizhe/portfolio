{"code":"import * as tslib_1 from \"tslib\";\r\nimport { spring, tween, decay, keyframes, physics, value, chain, easing, delay as delayAction } from 'popmotion';\r\nimport poseFactory from 'pose-core';\r\nimport defaultTransitions, { just } from '../inc/default-transitions';\r\nimport { number, degrees, percent, px } from 'style-value-types';\r\nimport { invariant } from 'hey-listen';\r\nvar valueTypeTests = [number, degrees, percent, px];\r\nvar testValueType = function (v) { return function (type) { return type.test(v); }; };\r\nvar createPassiveValue = function (init, parent, transform) {\r\n    var raw = value(init).pipe(transform);\r\n    parent.raw.subscribe(raw);\r\n    return { raw: raw };\r\n};\r\nvar createValue = function (init) {\r\n    var type = valueTypeTests.find(testValueType(init));\r\n    var raw = value(type === number ? type.parse(init) : init);\r\n    return { raw: raw, type: type };\r\n};\r\nvar addActionDelay = function (delay, transition) {\r\n    if (delay === void 0) { delay = 0; }\r\n    return chain(delayAction(delay), transition);\r\n};\r\nvar animationLookup = new Map([\r\n    ['tween', tween],\r\n    ['spring', spring],\r\n    ['decay', decay],\r\n    ['keyframes', keyframes],\r\n    ['physics', physics]\r\n]);\r\nvar easeIn = easing.easeIn, easeOut = easing.easeOut, easeInOut = easing.easeInOut, circIn = easing.circIn, circOut = easing.circOut, circInOut = easing.circInOut, backIn = easing.backIn, backOut = easing.backOut, backInOut = easing.backInOut, anticipate = easing.anticipate;\r\nvar easingLookup = new Map([\r\n    ['easeIn', easeIn],\r\n    ['easeOut', easeOut],\r\n    ['easeInOut', easeInOut],\r\n    ['circIn', circIn],\r\n    ['circOut', circOut],\r\n    ['circInOut', circInOut],\r\n    ['backIn', backIn],\r\n    ['backOut', backOut],\r\n    ['backInOut', backInOut],\r\n    ['anticipate', anticipate]\r\n]);\r\nvar getAction = function (v, _a, _b) {\r\n    var from = _b.from, to = _b.to, velocity = _b.velocity;\r\n    var _c = _a.type, type = _c === void 0 ? 'tween' : _c, ease = _a.ease, def = tslib_1.__rest(_a, [\"type\", \"ease\"]);\r\n    invariant(animationLookup.has(type), \"Invalid transition type '\" + type + \"'. Valid transition types are: tween, spring, decay, physics and keyframes.\");\r\n    if (type === 'tween') {\r\n        var typeOfEase = typeof ease;\r\n        if (typeOfEase !== 'function') {\r\n            if (typeOfEase === 'string') {\r\n                invariant(easingLookup.has(ease), \"Invalid easing type '\" + ease + \"'. popmotion.io/pose/api/transition\");\r\n                ease = easingLookup.get(ease);\r\n            }\r\n            else if (Array.isArray(ease)) {\r\n                invariant(ease.length === 4, \"Cubic bezier arrays must contain four numerical values.\");\r\n                var x1 = ease[0], y1 = ease[1], x2 = ease[2], y2 = ease[3];\r\n                ease = easing.cubicBezier(x1, y1, x2, y2);\r\n            }\r\n        }\r\n    }\r\n    return animationLookup.get(type)(tslib_1.__assign({ from: from,\r\n        to: to,\r\n        velocity: velocity,\r\n        ease: ease }, def));\r\n};\r\nvar isAction = function (action) {\r\n    return typeof action.start !== 'undefined';\r\n};\r\nvar pose = function (_a) {\r\n    var transformPose = _a.transformPose, addListenerToValue = _a.addListenerToValue, extendAPI = _a.extendAPI, readValueFromSource = _a.readValueFromSource;\r\n    return poseFactory({\r\n        bindOnChange: function (values, onChange) { return function (key) {\r\n            if (!values.has(key))\r\n                return;\r\n            var raw = values.get(key).raw;\r\n            raw.subscribe(onChange[key]);\r\n        }; },\r\n        readValue: function (_a) {\r\n            var raw = _a.raw;\r\n            return raw.get();\r\n        },\r\n        createValue: function (init, key, _a, _b) {\r\n            var elementStyler = _a.elementStyler;\r\n            var _c = _b === void 0 ? {} : _b, passiveParent = _c.passiveParent, passiveProps = _c.passiveProps;\r\n            var val = passiveParent\r\n                ? createPassiveValue(init, passiveParent, passiveProps)\r\n                : createValue(init);\r\n            if (addListenerToValue) {\r\n                val.raw.subscribe(addListenerToValue(key, elementStyler));\r\n            }\r\n            return val;\r\n        },\r\n        convertValue: function (raw, key, _a) {\r\n            var elementStyler = _a.elementStyler;\r\n            if (addListenerToValue) {\r\n                raw.subscribe(addListenerToValue(key, elementStyler));\r\n            }\r\n            return {\r\n                raw: raw,\r\n                type: valueTypeTests.find(testValueType(raw.get()))\r\n            };\r\n        },\r\n        getTransitionProps: function (_a, to) {\r\n            var raw = _a.raw, type = _a.type;\r\n            return ({\r\n                from: type ? type.parse(raw.get()) : raw.get(),\r\n                velocity: raw.getVelocity(),\r\n                to: type ? type.parse(to) : to,\r\n                type: type\r\n            });\r\n        },\r\n        resolveTarget: function (_a, to) {\r\n            var type = _a.type;\r\n            return (type ? type.parse(to) : to);\r\n        },\r\n        selectValueToRead: function (_a) {\r\n            var raw = _a.raw;\r\n            return raw;\r\n        },\r\n        startAction: function (_a, action, complete) {\r\n            var raw = _a.raw, type = _a.type;\r\n            var reaction = {\r\n                update: function (v) { return raw.update(v); },\r\n                complete: complete\r\n            };\r\n            return type\r\n                ? action.pipe(type.transform).start(reaction)\r\n                : action.start(reaction);\r\n        },\r\n        stopAction: function (action) { return action.stop(); },\r\n        getInstantTransition: function (_, _a) {\r\n            var to = _a.to;\r\n            return just(to);\r\n        },\r\n        convertTransitionDefinition: function (val, def, props) {\r\n            if (isAction(def))\r\n                return def;\r\n            var delay = def.delay, min = def.min, max = def.max, round = def.round, remainingDef = tslib_1.__rest(def, [\"delay\", \"min\", \"max\", \"round\"]);\r\n            var action = getAction(val, remainingDef, props);\r\n            var outputPipe = [];\r\n            if (delay)\r\n                addActionDelay(delay, action);\r\n            if (min !== undefined)\r\n                outputPipe.push(function (v) { return Math.max(v, min); });\r\n            if (max !== undefined)\r\n                outputPipe.push(function (v) { return Math.min(v, max); });\r\n            if (round)\r\n                outputPipe.push(Math.round);\r\n            return outputPipe.length ? action.pipe.apply(action, outputPipe) : action;\r\n        },\r\n        addActionDelay: addActionDelay,\r\n        defaultTransitions: defaultTransitions,\r\n        transformPose: transformPose,\r\n        readValueFromSource: readValueFromSource,\r\n        extendAPI: extendAPI\r\n    });\r\n};\r\nexport default pose;\r\n//# sourceMappingURL=pose.js.map","map":"{\"version\":3,\"file\":\"pose.js\",\"sourceRoot\":\"\",\"sources\":[\"../src/factories/pose.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/mattperry/Sites/popmotion/packages/popmotion-pose/factories/pose.d.ts","text":"import { Action } from 'popmotion/action';\r\nimport { ColdSubscription } from 'popmotion/action/types';\r\nimport { Value, PopmotionPoserFactoryConfig } from '../types';\r\nimport { Poser } from 'pose-core';\r\nexport { Poser };\r\ndeclare const pose: <P>({ transformPose, addListenerToValue, extendAPI, readValueFromSource }: PopmotionPoserFactoryConfig<P>) => (config: import(\"../../../pose-core/lib/types\").PoserConfig<Value>) => Poser<Value, Action, ColdSubscription, P>;\r\nexport default pose;\r\n"}}
